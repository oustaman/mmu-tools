<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Journey Map Builder - UXCI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --border-color: #e5e7eb;
            --accent-color: #8b5cf6;
            --font-size: 1;
        }
        
        .dark-mode {
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --border-color: #374151;
            --accent-color: #a78bfa;
        }
        
        html {
            font-size: calc(var(--font-size) * 16px);
        }
        
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        .stage-card {
            min-height: 120px;
            transition: all 0.2s ease;
        }

        .stage-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .emotion-line {
            stroke-width: 3;
            fill: none;
        }

        @media print {
            .no-print { display: none; }
        }
    </style>
</head>
<body class="min-h-screen">
    <header class="border-b p-4 no-print" style="border-color: var(--border-color);">
        <div class="max-w-7xl mx-auto flex justify-between items-center flex-wrap gap-4">
            <div>
                <h1 class="text-2xl font-bold">üó∫Ô∏è User Journey Map Builder</h1>
                <p class="text-sm" style="color: var(--text-secondary);">Map user experiences across touchpoints and stages</p>
            </div>
            <div class="flex gap-2">
                <button id="decreaseFont" class="px-3 py-2 rounded border" style="border-color: var(--border-color);" aria-label="Decrease font size">A-</button>
                <button id="increaseFont" class="px-3 py-2 rounded border" style="border-color: var(--border-color);" aria-label="Increase font size">A+</button>
                <button id="darkModeToggle" class="px-4 py-2 rounded border" style="border-color: var(--border-color);" aria-label="Toggle dark mode">
                    <span id="modeIcon">üåô</span>
                </button>
                <button onclick="window.location.href='index.html'" class="px-4 py-2 rounded border" style="border-color: var(--border-color);">
                    ‚Üê Back
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-8">
        <!-- Setup Section -->
        <div class="mb-8 p-6 rounded-lg border no-print" style="border-color: var(--border-color); background-color: var(--bg-secondary);">
            <h2 class="text-xl font-bold mb-4">Journey Setup</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Journey Name *</label>
                    <input type="text" id="journeyName" class="w-full p-2 rounded border" style="border-color: var(--border-color);" placeholder="e.g., Booking a Study Room" onchange="updateJourney()">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">User Persona</label>
                    <input type="text" id="personaName" class="w-full p-2 rounded border" style="border-color: var(--border-color);" placeholder="e.g., Sarah - Graduate Student" onchange="updateJourney()">
                </div>
            </div>
        </div>

        <!-- Stages Control -->
        <div class="mb-8 p-6 rounded-lg border no-print" style="border-color: var(--border-color); background-color: var(--bg-secondary);">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Journey Stages</h2>
                <div class="flex gap-2">
                    <button onclick="addStage()" class="px-4 py-2 rounded text-white" style="background-color: var(--accent-color);">
                        + Add Stage
                    </button>
                    <button onclick="exportToPNG()" class="px-4 py-2 rounded border" style="border-color: var(--accent-color); color: var(--accent-color);">
                        üì• Export PNG
                    </button>
                    <button onclick="window.print()" class="px-4 py-2 rounded border" style="border-color: var(--border-color);">
                        üñ®Ô∏è Print
                    </button>
                </div>
            </div>
            <p class="text-sm" style="color: var(--text-secondary);">Typical stages: Awareness ‚Üí Consideration ‚Üí Action ‚Üí Use ‚Üí Support</p>
        </div>

        <!-- Journey Map Canvas -->
        <div id="journeyCanvas" class="p-8 rounded-lg border" style="border-color: var(--border-color); background-color: white;">
            <!-- Header -->
            <div class="mb-8 text-center">
                <h1 id="displayJourneyName" class="text-3xl font-bold mb-2">User Journey Map</h1>
                <p id="displayPersona" class="text-lg" style="color: var(--text-secondary);">Persona: [Not Set]</p>
            </div>

            <!-- Stages Container -->
            <div id="stagesContainer" class="space-y-6">
                <!-- Initial stage will be added by JavaScript -->
            </div>

            <!-- Emotion Graph -->
            <div class="mt-12 p-6 rounded-lg" style="background-color: var(--bg-secondary);">
                <h3 class="font-bold mb-4 text-center">Emotional Journey</h3>
                <svg id="emotionGraph" width="100%" height="200" class="rounded"></svg>
                <div class="flex justify-between mt-2 text-xs" style="color: var(--text-secondary);">
                    <span>üò¢ Frustrated</span>
                    <span>üòê Neutral</span>
                    <span>üòä Delighted</span>
                </div>
            </div>
        </div>
    </main>

    <script>
        let stages = [];
        let stageCounter = 0;

        // Initialize with one stage
        function initializeJourney() {
            addStage();
            updateJourney();
        }

        function addStage() {
            const stageId = stageCounter++;
            stages.push({
                id: stageId,
                name: `Stage ${stageCounter}`,
                actions: '',
                touchpoints: '',
                thoughts: '',
                emotions: 'neutral',
                painPoints: '',
                opportunities: ''
            });
            renderStages();
        }

        function removeStage(id) {
            if (stages.length <= 1) {
                alert('You need at least one stage in your journey!');
                return;
            }
            if (confirm('Remove this stage?')) {
                stages = stages.filter(s => s.id !== id);
                renderStages();
                updateEmotionGraph();
            }
        }

        function updateStage(id, field, value) {
            const stage = stages.find(s => s.id === id);
            if (stage) {
                stage[field] = value;
                if (field === 'emotions') {
                    updateEmotionGraph();
                }
            }
        }

        function renderStages() {
            const container = document.getElementById('stagesContainer');
            container.innerHTML = '';

            stages.forEach((stage, index) => {
                const stageDiv = document.createElement('div');
                stageDiv.className = 'stage-card p-6 rounded-lg border';
                stageDiv.style.borderColor = 'var(--border-color)';
                stageDiv.style.backgroundColor = 'var(--bg-secondary)';
                
                stageDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <input type="text" value="${stage.name}" 
                            class="text-xl font-bold border-0 bg-transparent focus:outline-none" 
                            style="color: var(--accent-color);"
                            onchange="updateStage(${stage.id}, 'name', this.value); renderStages();"
                            placeholder="Stage Name">
                        <button onclick="removeStage(${stage.id})" class="px-3 py-1 text-sm rounded border no-print" 
                            style="border-color: var(--border-color); color: #ef4444;">
                            Remove
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold mb-1" style="color: var(--text-secondary);">üé¨ USER ACTIONS</label>
                            <textarea rows="2" class="w-full p-2 text-sm rounded border" 
                                style="border-color: var(--border-color);"
                                placeholder="What does the user do?"
                                onchange="updateStage(${stage.id}, 'actions', this.value)">${stage.actions}</textarea>
                        </div>

                        <div>
                            <label class="block text-xs font-bold mb-1" style="color: var(--text-secondary);">üì± TOUCHPOINTS</label>
                            <textarea rows="2" class="w-full p-2 text-sm rounded border" 
                                style="border-color: var(--border-color);"
                                placeholder="Mobile app, Website, Email, etc."
                                onchange="updateStage(${stage.id}, 'touchpoints', this.value)">${stage.touchpoints}</textarea>
                        </div>

                        <div>
                            <label class="block text-xs font-bold mb-1" style="color: var(--text-secondary);">üí≠ THOUGHTS & FEELINGS</label>
                            <textarea rows="2" class="w-full p-2 text-sm rounded border" 
                                style="border-color: var(--border-color);"
                                placeholder="What is the user thinking?"
                                onchange="updateStage(${stage.id}, 'thoughts', this.value)">${stage.thoughts}</textarea>
                        </div>

                        <div>
                            <label class="block text-xs font-bold mb-1" style="color: var(--text-secondary);">üòä EMOTION</label>
                            <select class="w-full p-2 text-sm rounded border" 
                                style="border-color: var(--border-color);"
                                onchange="updateStage(${stage.id}, 'emotions', this.value); updateEmotionGraph();">
                                <option value="very-negative" ${stage.emotions === 'very-negative' ? 'selected' : ''}>üò¢ Very Frustrated</option>
                                <option value="negative" ${stage.emotions === 'negative' ? 'selected' : ''}>üòï Frustrated</option>
                                <option value="neutral" ${stage.emotions === 'neutral' ? 'selected' : ''}>üòê Neutral</option>
                                <option value="positive" ${stage.emotions === 'positive' ? 'selected' : ''}>üôÇ Satisfied</option>
                                <option value="very-positive" ${stage.emotions === 'very-positive' ? 'selected' : ''}>üòä Delighted</option>
                            </select>
                        </div>
                    </div>

                    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold mb-1" style="color: #dc2626;">üò§ PAIN POINTS</label>
                            <textarea rows="2" class="w-full p-2 text-sm rounded border" 
                                style="border-color: var(--border-color); background-color: #fee2e2;"
                                placeholder="What frustrates the user?"
                                onchange="updateStage(${stage.id}, 'painPoints', this.value)">${stage.painPoints}</textarea>
                        </div>

                        <div>
                            <label class="block text-xs font-bold mb-1" style="color: #059669;">üí° OPPORTUNITIES</label>
                            <textarea rows="2" class="w-full p-2 text-sm rounded border" 
                                style="border-color: var(--border-color); background-color: #d1fae5;"
                                placeholder="How could this be improved?"
                                onchange="updateStage(${stage.id}, 'opportunities', this.value)">${stage.opportunities}</textarea>
                        </div>
                    </div>
                `;
                
                container.appendChild(stageDiv);
            });

            updateEmotionGraph();
        }

        function updateEmotionGraph() {
            const svg = document.getElementById('emotionGraph');
            const width = svg.clientWidth;
            const height = 200;
            const padding = 40;
            
            if (stages.length === 0) return;

            const emotionValues = {
                'very-negative': 20,
                'negative': 60,
                'neutral': 100,
                'positive': 140,
                'very-positive': 180
            };

            const points = stages.map((stage, i) => {
                const x = padding + (i * (width - 2 * padding) / (stages.length - 1 || 1));
                const y = emotionValues[stage.emotions] || 100;
                return `${x},${y}`;
            });

            svg.innerHTML = `
                <!-- Grid lines -->
                <line x1="${padding}" y1="20" x2="${width - padding}" y2="20" stroke="var(--border-color)" stroke-dasharray="2,2"/>
                <line x1="${padding}" y1="100" x2="${width - padding}" y2="100" stroke="var(--border-color)" stroke-dasharray="2,2"/>
                <line x1="${padding}" y1="180" x2="${width - padding}" y2="180" stroke="var(--border-color)" stroke-dasharray="2,2"/>
                
                <!-- Emotion line -->
                <polyline points="${points.join(' ')}" class="emotion-line" stroke="var(--accent-color)"/>
                
                <!-- Data points -->
                ${stages.map((stage, i) => {
                    const x = padding + (i * (width - 2 * padding) / (stages.length - 1 || 1));
                    const y = emotionValues[stage.emotions] || 100;
                    return `
                        <circle cx="${x}" cy="${y}" r="6" fill="var(--accent-color)"/>
                        <text x="${x}" y="${height - 5}" text-anchor="middle" font-size="12" fill="var(--text-secondary)">${stage.name}</text>
                    `;
                }).join('')}
            `;
        }

        function updateJourney() {
            const journeyName = document.getElementById('journeyName').value || 'User Journey Map';
            const personaName = document.getElementById('personaName').value;
            
            document.getElementById('displayJourneyName').textContent = journeyName;
            document.getElementById('displayPersona').textContent = personaName ? `Persona: ${personaName}` : 'Persona: [Not Set]';
        }

        async function exportToPNG() {
            const canvas = document.getElementById('journeyCanvas');
            const journeyName = document.getElementById('journeyName').value || 'journey';
            
            try {
                const canvasElement = await html2canvas(canvas, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    logging: false,
                    useCORS: true
                });
                
                canvasElement.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().slice(0,10);
                    link.download = `${journeyName.replace(/\s+/g, '_')}_journey_${timestamp}.png`;
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);
                });
                
            } catch (error) {
                console.error('Error exporting PNG:', error);
                alert('Error exporting PNG. Please try again.');
            }
        }

        // Dark mode and font size controls
        let isDarkMode = false;
        let fontSize = 1;

        document.getElementById('darkModeToggle').addEventListener('click', () => {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');
            document.getElementById('modeIcon').textContent = isDarkMode ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('uxci_darkMode', isDarkMode);
        });

        document.getElementById('increaseFont').addEventListener('click', () => {
            if (fontSize < 1.5) {
                fontSize += 0.1;
                document.documentElement.style.setProperty('--font-size', fontSize);
                localStorage.setItem('uxci_fontSize', fontSize);
            }
        });

        document.getElementById('decreaseFont').addEventListener('click', () => {
            if (fontSize > 0.7) {
                fontSize -= 0.1;
                document.documentElement.style.setProperty('--font-size', fontSize);
                localStorage.setItem('uxci_fontSize', fontSize);
            }
        });

        // Load saved preferences
        const savedDarkMode = localStorage.getItem('uxci_darkMode') === 'true';
        const savedFontSize = parseFloat(localStorage.getItem('uxci_fontSize')) || 1;
        
        if (savedDarkMode) {
            document.body.classList.add('dark-mode');
            document.getElementById('modeIcon').textContent = '‚òÄÔ∏è';
            isDarkMode = true;
        }
        
        fontSize = savedFontSize;
        document.documentElement.style.setProperty('--font-size', fontSize);

        // Initialize
        initializeJourney();
    </script>
</body>
</html>
